#labels Featured,Phase-Implementation
=Самостоятельное производство Пикселькита=
На этой странице я попытаюсь объяснить вам, как в домашних условиях можно собрать Пикселькит и модифицировать с его помощью ваш любимый старый геймпад. Не смотря на то, что мы предоставляем разведённую плану всем желающим, я не стану описывать принципы [http://ru.wikipedia.org/wiki/%D0%9B%D0%B0%D0%B7%D0%B5%D1%80%D0%BD%D0%BE-%D1%83%D1%82%D1%8E%D0%B6%D0%BD%D0%B0%D1%8F_%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F лазерно-утюжной технологии] (ЛУТ) со всеми шагами производства. Вы можете найти огромную массу таких туториалов в Рунете.

Итак, для того чтобы самостоятельно собрать Пикселькит и провести с его помощью модификацию вам потребуются:
  # Готовая печатаная плата
  # Кварцевый генератор с частотой 12 Мгц (в низком корпусе “лодочка”)
  # 2 стабилитрона на 3.6 вольта
  # 2 резистора на 68 Ом
  # Резистор на 1.5 кОм
  # Чип ATmega8-16PU (DIP корпус, 28 ножек)
  # Провод со стандартным USB-коннектром длинной 1.3-1.8м. Идеально подойдёт провод от старой мыши -- он достаточно эластичен, подходит по толщине и длине.
  # Программатор для ATmega8. Подойдёт любой. Можно собрать самостоятельно, можно купить готовый примерно за $20, можно попросить у знакомых. Лично я для прошивки этого чипа всегда использовал [http://arduino.cc/ Arduino]. Именно этот процесс я и опишу.
  # Оригинальный геймпад из списка совместимых
  # Термоклей (тот который течёт из горячих пистолетов) или эпоксидка. Второй вариант рекомендую тем, кто уверен, что сможет разместить всё правильно с первого раза.

Разумеется, вам понадобятся инструменты. Я не буду перечислять банальные вещи, типа паяльника и бокорезов, зато скажу о некоторых специфичных.

Крайне желательно иметь под рукой [http://www.dremeleurope.com/dremelocs-ru/Category.jsp?ccat_id=471 Dremel] или другой аналогичный аппарат. С его помощью очень удобно вырезать лишние части на внутренней стороне корпуса геймпада. Кроме этого, с его помощью нужно будет просверлить плату, после травления (сверлом диаметром около 0.6 мм). Так же желательно располагать пистолетом для термоклея. Такой клей достаточно хорошо фиксирует компоненты внутри геймпада и при этом оставляет вам возможность вынуть их, если вы вдруг допустите ошибку при установке.
==Производство==
Как я уже сказал выше, вытравливание и лужение платы я оставляю вам на откуп. Могу посоветовать [http://www.youtube.com/watch?v=a5TROBHsMWs метод], которым пользуется DiHalt - он один из самых надёжных. Хотя, конечно, тут у каждого собственные секреты (я, например, печатаю рисунок не на фотобумаге, а на странице Популярной Механики, а раствор железа всегда сильно грею, для того чтобы травилось максимально быстро).

Для того, чтобы распечатать рисунок платы устанавливаем себе бесплатную [http://cadsoft.de/download.htm CAD Eagle] и открываем в нём brd-файл с разводкой платы. Кнопкой Display (1) отключаем слои с ненужной ерундой, оставляем только Bottom и Pads (2). Жмём кнопку Print и настраиваем отступы по желанию. На этом этапе (если вы готовите плату ЛУТом) важно помнить, что галка “mirror” должна быть снята. Иначе вам придётся паять все компоненты к одной стороне платы, а чип к обратной -- скорее всего такая “конструкция” в итоге не влезет в геймпад.
<div><a href="http://picasaweb.google.ru/lh/photo/cfiu756q_weurKNuejIxoQ?feat=embedwebsite"><img src="http://lh3.ggpht.com/_pcbSxfY74TA/TDRWeHtuorI/AAAAAAAAAlA/1WhbndqqdsU/s400/01-eagle-layers.jpg" /></a></div>
При производстве важно соблюсти размер платы. Вы, например, можете вытравить рисунок на большом куске текстолита, и потом обточить его до минимума с помощью того же дремеля. Сделать это нужно в основном для того, чтобы ваша плата гарантированно влезла в корпус геймпада и не создавала внутри проблем оригинальным компонентам (внутри геймпада от SMD2, например, крайне мало места).

О контроле травления и лужения я не упоминаю -- никаких спаек и неправильно замкнутых контактов быть не должно. При грамотном использовании ЛУТ может обеспечить вас дорожками толшиной всего в 0.1 мм. Для сравнения, основная часть дорожек в нашем дизайне имеет толшину 0.254 мм.

В результате всех манипуляций с текстолитом, железом, сверлом и напильником у вас должна получиться примерно такая платка, размером около 22х37 мм.
<div><a href="http://picasaweb.google.ru/lh/photo/I79z9spQBVKKa-gqFeJUBg?feat=embedwebsite"><img src="http://lh4.ggpht.com/_pcbSxfY74TA/TDRWebaeCaI/AAAAAAAAAlE/Rl0_Ir0Hg48/s400/02-Etching_result.jpg" /></a></div>
==Прошивка для микроконтроллера==
ATmega8 работает не сама по себе, а под управлением микропрограммы, которая командует транспортировкой сигналов между оригинальным интерфейсом геймпада и шиной USB. Такая программа называется прошивкой.

Исходные коды прошивки выложены у нас в [http://code.google.com/p/pixel-kit/source/browse/#svn/trunk/src репозитории]. Они хорошо (в некоторых местах даже избыточно) документированы и любой заинтересованный человек с номинальным знанием английского языка сможет в них разобраться. Разумеется перед заливкой прошивки в микроконтроллер её необходимо скомпилировать. Не обременяя вас процессом мы уже [http://code.google.com/p/pixel-kit/downloads/detail?name=pixelkit_firmware_v0.9.1.hex сделали это]. Теперь файл с расширением hex необходимо поместить во внутреннюю память вашей ATmega8. Этот процесс, как ни парадоксально, тоже называется “прошивка”, только в этот раз слово выступает в качестве глагола.
==Прошивка микроконтроллера==
Есть множество способов поместить прошивку внутрь микросхемы. В основном для этого используются специальные устройства -- программаторы. Если у вас есть собственный программатор, или друг им обладающий, можете смело пропускать этот раздел -- у вас итак всё получится. Остальным я расскажу, как можно прошить микроконтроллер используя в качестве программатора Arduino или любую другую плату этого популярного семейства и простой BitBang-кабель.

Такой способ прошивки основан на микросхеме FT232RL, которая припаяна к вашему Arduino и реализует COM-порт на шине USB. Соответственно для этого способа подойдут только USB-версии Arduino, при этом у них должна быть разведена группа контактов X3. Идеально для этого подойдёт плата [http://freeduino.ru/arduino/index.html Freeduino].
<div><a href="http://picasaweb.google.ru/lh/photo/YylguinwfTtCo_XMvkH4Yw?feat=embedwebsite"><img src="http://lh6.ggpht.com/_pcbSxfY74TA/TDRWegLr40I/AAAAAAAAAlI/vSLTTe7zexc/s400/03-BitBang-X3.jpg" /></a></div>
При этом оригинальный чип из Arduino (ATmega168) вам не понадобится, а на его место, прямо в панельку нужно установить вашу ATmega8-16PU. Обязательно соблюдайте ориентирование микроконтроллера при установке -- первая ножка отмечена ключём-выемкой.

После установки микроконтроллера в Arduino необходимо соединить выводы X3 с выводами ICSP как это показано на схеме выше. Можно использовать модифицированный аудиокабель от старых CD-приводов или воспользоваться несколькими проводками со специальными захватами. Такое соединение фактически и будет являться Bit-Bang кабелем.

После всех манипуляций с Arduino подключаем его в таком виде к вашему компьютеру USB-шнуром и приступаем непосредственно к процессу прошивки. 

Для того чтобы отправить hex-файл с прошивкой с вашего жёсткого диска в микроконтроллер, вам потребуется программа [http://freeduino.ru/arduino/files/Arduino-Bit-Bang-ISP.zip AVRdude]. Программа работает через командную строку, поэтому сразу советую установить [http://yuki-lab.jp/hw/avrdude-GUI/avrdude-GUI-1.0.5.zip GUI] для неё.
<div><a href="http://picasaweb.google.ru/lh/photo/t32hv_ZU1Z3-KX1GFvQ5FQ?feat=embedwebsite"><img src="http://lh3.ggpht.com/_pcbSxfY74TA/TDRWeiYgIbI/AAAAAAAAAlM/d8sBMOu8rEY/s400/04-avrdudeGUI.jpg" /></a></div>
Запускаем avrdude-GUI.exe. В открывшемся окне: 
  # В поле “avrdude.exe File” (1) указываем путь к соответствующму файлу
  # В выпадающем списке “Programmer” (2) выбираем FT232R Synchronous BitBang (diecimila)
  # Поле “Port” оставляем пустым
  # В выпадающем списке “Device” (3) выбираем ATmega8
  # В графу “Command Line Option” (4) без кавычек вписываем “-P ft0 -B 4800”, где “-P ft0” -- выбор первого устройства с чипом FTDI, а  “-B 4800” -- установка низкой скорости для обмена.
Теперь нужно проверить, видит ли avrdude вашу ATmega8. Для этого необходимо прочитать т.н. фьюз-биты. Fuse-bits это, по сути, флаги, которые объясняют микроконтроллеру, как нужно работать внутри конкретного дизайна платы. Например, с их помощью можно указать какой генератор частоты используется в дизайне -- внутренний или внешний  и т.д. Не углубляясь в подробности, скажу, что для нашего дизайна нужно будет записать в *hight-fuse значение С9*, а в *low-fuse значение 9F*. Но прежде чем это делать, нам нужно проверить работоспособность путём чтения фьюз-битов, которые были записаны в наш микроконтроллер на заводе.
  # Нажимаем кнопку “Read” внутри блока “Fuse” (5). Если биты прочитались, то это значит, что наш программатор работает и с его помощью можно “шить”
  # Записываем необходимые нам hFuse и lFuse в соответствующие поля. Жмём кнопку “Write” и подтверждаем выбор
  # Можно снова попробовать нажать на кнопку “Read” и если на предыдущем шаге биты записались, то после чтения в полях они останутся неизменными
  # Теперь из поля “Command Line Option” можно убрать ключ “-B 4800” и работать на полной скорости
  # Далее в блоке “Flash” (6) в пустом поле выбираем путь к нашей прошивке с расширением hex
  # Жмём кнопку “Erase-Write-Verify”, которая находится в этом же блоке и ждём когда прошивка загрузится в память микроконтроллера предварительно стерев оттуда заводскую.

На последнем этапе прошивки приложение может зависнуть на пару секунд. Тем не менее, весь процесс проходит успешно и прошивка корректно загружается в микроконтроллер. Более подробно о процессе прошивки через BitBang-кабель можно [http://www.geocities.jp/arduino_diecimila/bootloader/index_en.html почитать в этой заметке] (в ней рассмотрен процесс прошивки “родного” для Arduino микроконтроллера ATmega168).
==Монтаж компонентов на плату==
Внимательно сверяясь с принципиальной схемой производим монтаж компонентов на вашу плату. Важно не перепутать ориентацию микроконтроллера. Так же помните о том, что, в отличие от резисторов, для которых не важно какой стороной вы их установите, стабилитроны -- направленные компоненты. Их выход отмечен чёрной полоской и ориентировать её нужно строго по схеме.
<div><a href="http://picasaweb.google.ru/lh/photo/UTPnz5ImNikqSfFsuGoNJg?feat=embedwebsite"><img src="http://lh6.ggpht.com/_pcbSxfY74TA/TDRWe8Le79I/AAAAAAAAAlQ/KOj6AB_jrgE/s400/05-Blueprint-schem.jpg" /></a></div>
Пикселькит содержит две перемычки, которые вам нужно будет замкнуть в зависимости от того, какой контроллер вы ходите модифицировать. Для SNES не нужно замыкать ничего, для NES (Dendy) -- замкнуть первую, для интерфейса DB9 (Sega, Atari) -- обе враз, ну и если вы вдруг нашли где-то геймпад от PCE, то замкнуть нужно будет только вторую перемычку. Я обычно просто впаиваю в качестве перемычек отрезанные ножки компонентов, которые смонтировал ранее.

*При неправильно выставленных перемычках геймпад не будет корректно работать.*
<div><a href="http://picasaweb.google.ru/lh/photo/xghaGBRgHwPFqdYCZSslUA?feat=embedwebsite"><img src="http://lh4.ggpht.com/_pcbSxfY74TA/TDRWnnMVdKI/AAAAAAAAAlU/tR03svWsnLI/s400/06-JPs_map.jpg" /></a></div>
Руководствуясь вышеописанными рекомендациями припаивайте компоненты на плату, не забывая отрезать все лишние части с обратной стороны под самый корень. Всё это делается для уменьшения высоты платы. Так как компонентов на плате кот наплакал можете руководствоваться фотографиями в качестве туториала для пайки.
<div><a href="http://picasaweb.google.ru/lh/photo/ujL9ZVqSEJ403K0LwjJxfA?feat=embedwebsite"><img src="http://lh3.ggpht.com/_pcbSxfY74TA/TDRWn_qLAJI/AAAAAAAAAlY/SIANIAnGvfI/s400/07-PCB.jpg" /></a></div>
После монтажа компонентов отмойте плату от флюса каким-нибудь подходящим раствором. Я использую для этого кисточку и спирт. После того, как плата высохнет тщательно проверьте всё, что сделали на предмет спаек, перетравок, замкнутых в ненужных местах контактных площадок и пр.

Всё, ваш собственный Пикселькит готов. Теперь нужно засунуть его в геймпад.
==Подготовка геймпада==
Как я уже рассказывал, основные работы, которые вам придётся проделать при подготовке геймпада к модификации -- удаление внутренних деталей корпуса. Разумеется, для каждой модели геймпада эти детали отличаются. Например, в геймпаде от SNES достаточно места для установки, не только Пикселькита, но и флешки с хабом. А внутри контроллера от Sega Mega Drive 2 его еле хватает на установку одной только платы. Хотя тут, конечно всё зависит от желания. Обладая им можно попытаться использовать не только внешнюю поверхность основной платы геймпада (которая находится под задней крышкой), но и внутреннюю (которая находится спереди со стороны кнопок).

Итак, разобрав ваш геймпад (достаточно снять заднюю крышку, саму плату вынимать не нужно) примерно прикиньте с какой стороны вы можете установить Пикселькит. У меня чаще получается ставить его слева, прямо под action-кнопки. Теперь посмотрите на заднюю крышку, которую вы только что открутили и проанализируйте, какие её детали смогут помешать вашему замыслу. Если это рёбра жёсткости (во время суматошной игры и баттон-мэшинга на кнопки оказывается жуткое давление, поэтому, чтобы основная плата геймпада не надломилась, на обратной стороне крышки обычно делают несколько пластиковых колец-упоров), то всё хорошо. Если помимо них в зону установки попадают например стойки шурупов, или пластиковые крепежи основной платы, то, скорее всего, вам придётся найти новое посадочное место для Пикселькита.

Определившись с местом остаётся только беспощадно вырезать весь мешающий пластик с крышки не повредев её саму. Сделать это, как я уже говорил будет проще всего дремелем. После него даже нет необходимости в зачистке оставшейся поверхности. Из более простых инструментов может быть сгодятся бокорезы и напильник, а так же детский выжигатель. Но это конечно, хардкор.)
<div><a href="http://picasaweb.google.ru/lh/photo/DSliH0Cr_0wdT2si0mIe-Q?feat=embedwebsite"><img src="http://lh6.ggpht.com/_pcbSxfY74TA/TDRWoM1ZvOI/AAAAAAAAAlc/mYd6oNF_W2s/s400/08-Cut.jpg" /></a></div>
После того, как вы поправили корпус, установите Пикселькит в намеченное вами место и временно закрепите (двусторонним скотчем, пластикой, каплей термоклея -- неважно). Установить Пикселькит нужно компонентами к задней крышке. Т.е. та сторона Пикселькита, на которой вы осуществляли пайку должна прилегать к основной плате геймпада. После установки попробуйте закрыть крышку так, чтобы она не деформировалась. Если всё получается, то можно переходить к окончательному монтажу.
==Установка Пикселькита==
Для окончательной упаковки геймпада вам осталось соединить оригинальный интерфейсный провод вашего контроллера со входами Пикселькита, а USB-кабель с его выводами.

Старайтесь экономно расходовать пространство внутри геймпада -- используйте ровно столько проводов, сколько необходимо, не больше. После того, как вы припаяете все интерфейсные провода и USB-кабель согласно вышеопубликованным схемам, у вас появится возможность проверить работоспособность вашего старого-нового друга. После чего геймпад можно будет упаковать, закрепив Пикселькит и некоторые провода с помощью термоклея. Закрывая крышку и закручивая шурупы старайтесь сильно не пережимать тонкие проводки, которые могут со временем перетереться от интенсивных баталий.
<div><a href="http://picasaweb.google.ru/lh/photo/BPtQQfS26Vzse3mCT0VqWg?feat=embedwebsite"><img src="http://lh5.ggpht.com/_pcbSxfY74TA/TDRWoeyDTQI/AAAAAAAAAlg/d0F4fXGN9q4/s400/09-Finish.jpg" /></a></div>
Визуально проверьте всё в последний раз. Нажатие кнопок, крепление провода, деформацию корпуса и пр. И если всё в порядке, то подключайте ваш геймпад к компьютеру, устанавливайте эмулятор вместе с Battle City, Contra или Chrono Trigger и начинайте испытывать чувство неподдельной ностальгии по временам, когда деревья были выше и зеленее, а сахар слаще и вкуснее.

И да, присылайте нам фотографии того, что у вас получилось! Мы разместим их в общем альбоме.